# every character has the following stats:
        # Karma
    #certain choices are only possible with certain characters

from time import sleep

sl = 5

def clean_input(prompt, length):
    # define recursive function to get clean player input
    while True:
        try:
            choice = int(input(prompt))
        except ValueError:
            print("Please do not break our game. Input only integers.")
            return clean_input(prompt, length)
        if choice in range(1, length + 1):
            return choice
        else:
            print("Please input only integers between 1 and {}.".format(length))
            return clean_input(prompt, length)


def choose_character():
    #define a function which facilitates character choice
    print("Welcome to our text adventure!")
    print("The game is contained to your terminal. Enlarge it and enjoy!")
    print("The following story takes place in the STAR WARS universe.")
    print()
    sleep(sl)
    name = input("What is your name?: ")
    print()
    print("Hello, {}. Before your adventure starts, choose your character:".format(name))
    print()
    sleep(sl)
    print("Option 1: Jedi.")
    print("This Jedi's agility, wisdom, and control of the force is unmatched. He is quite popular with upright citizens.")
    print()
    print("Option 2: Bounty Hunter.")
    print("Bounty Hunters are known to be strong and intimidating individuals. He isn't the smartest but his gadgets are helpful.")
    print()
    print("Option 3: Smuggler")
    print("The smuggler is scrawny and weak. He wields a blaster and is highly charismatic. He has an affinity for technology.")
    print()
    #check if input is okay
    prompt = "Please type 1, 2, or 3 to denote your choice: "
    length = 3
    choice = clean_input(prompt, length)
    if choice == 1:
        character = "Jedi"
    elif choice == 2:
        character = "Bounty Hunter"
    else:
        character = "Smuggler"
    print()
    print("Good luck, {} the {}. And remember: your choices matter!".format(name, character))
    print()
    return character

def intro_sequence(character):
    #define a function that prints the intro sequence depending on character choice
    sleep(sl)
    print("2 weeks ago, a Holocron - a Jedi artifact containing immense knowledge - was stolen from the Jedi temple.")
    print("Word is that the Holocron is being stored on a junk planet called 9-NR3W.")
    print()
    sleep(5)
    print()
    if character == "Jedi":
        print("The Jedi council has tasked you to retrieve the artifact, since it contains valuable wisdom about the force.")
        print("Make sure that the artifact does not stay in the hands of crooks and bring it back to the Jedi council!")
        sleep(5)
    if character == "Bounty Hunter":
        print("You are a bounty hunter. The Huts, a powerful clan, have tasked you with retrieving a valuable artifact.")
        print("You don't know what a Holocron even is but you are in it for the money.")
        print("You are determined to get your reward, whatever it takes!")
        sleep(5)
    if character == "Smuggler":
        print("Your brother, the thief of the Holocron has tasked you with retrieving the artifact.")
        print("You don't know what to expect on the dangerous planet but you are determined to find the Holocron.")
        print("Due to its high value, you hope that your family may finally be free of their debt.")
        sleep(5)
    print()
    print()
    print("You are approaching 9-NR3W and decide to land your ship on a nearby mining village, located at the edge of a huge junk field.")
    print("There is garbage everywhere but it seems that the local people have managed to adapt to their environment.")
    print()
    sleep(10)
    print("A shady alien approaches you, asking for 5 credits due to you parking your ship in his backyard.")
    print()
    sleep(sl)
    print("You argue with him but ultimately decide to pay. He's not worth the effort. You don't have many credits left. The journey was long.")
    print()

def bar(character, karma):
    # function that handles the bar scene
    print("You decide to head to the local bar as a starting point for your investigation.")
    sleep(5)
    print()
    print("The air is thick, it smells like alcohol. Where could you find information about the Holocron?")
    sleep(sl)
    print()
    print("You look around and spot the following opportunities:")
    print()
    print("Option 1:")
    print("Approach the Barkeeper and ask for information.")
    print()
    print("Option 2:")
    print("Try to intimidate the guests into telling you whether they saw something recently.")
    print()
    print("Option 3:")
    print("Ask a hostess whether she saw something.")
    print()
    print("Option 4: ")
    print("Approach a shady gambling table. Maybe you can gather the information by winning a game of cards?")
    print()
    prompt = "Please type 1, 2, 3, or 4 to make a choice: "
    length = 4
    while True:
        choice = clean_input(prompt, length)
        if choice == 1:
            sleep(sl)
            print("You approach the barkeeper and ask for information about any recent uncommon occurrances.")
            print()
            sleep(sl)
            print("The barkeeper grunts. No payment, no information he says.")
            print("Considering your bleak finances you decide to try talking to somebody else.")
            print()
        elif choice == 2:
            if character == "Bounty Hunter":
                print("Using your large stature and weapons you intimidate the guests.")
                print()
                sleep(sl)
                print("One patron in particular is so afraid of you, he wimpers something about a junk dealer named Arne who usually knows about valuable goods coming through.")
                print("Apparently this guy is located at the Black Market. If you take a speeder you can be there in 1h.")
                print()
                print("You decide to ask for further information.")
                sleep(sl)
                print("Another patron steps in. He throws a beverage at you and yells that you better leave now.")
                sleep(sl - 2)
                print("You duck at the last second.")
                sleep(sl - 2)
                print("The drink hits somebody else, your karma decreased.")
                print()
                sleep(sl)
                print("A full on brawl ensures. What will you do?")
                print()
                print("Option 1:")
                print("Fight your way out.")
                print()
                print("Option 2:")
                print("Try to use the turmoil to escape.")
                prompt = "Type 1 or 2 to make a choice: "
                length = 2
                choice2 = clean_input(prompt, length)
                if choice2 == 1:
                    sleep(sl)
                    print()
                    print("You partake in the brawl and sure enough you are able to overpower the attackers.")
                    print()
                    sleep(sl)
                    print("You decide to leave the bar but you are intercepted by the local police.")
                    sleep(sl)
                    print("They decide that you will spend some time in jail for violating the local order.")
                    value = prison_choice()
                    if value == 1:
                        break
                    else:
                        quit()
                elif choice2 == 2:
                    print("You weave between fighting drunks and manage to escape the bar.")
                    sleep(sl)
                    print("You decide to head for the Black Market. Time to see what this Arne guy knows.")
                    break
            else:
                print("The patrons don't seem intimidated by you. Maybe you should try something else.")
        elif choice == 3:
            print("You approach the hostess and ask her whether she has seen anything recently.")
            if character == "Jedi" or character == "Smuggler":
                sleep(sl)
                print("You decide to use your charme to persuade her to tell you about a local junk dealer.")
                sleep(sl - 2)
                print()
                print("There's a guy known for being involved in shady business and knowledgable about any valuable items passing through.")
                print()
                sleep(sl)
                print("The hostess tells you that his name is Arne. He frequents the Black Market, a cesspool for crooks.")
                sleep(sl)
                print()
                print("You leave the bar and head to the Black Market. With a speeder it will take 1h to arrive.")
                print()
                break
            else:
                print("You are not a very charming person, maybe if you were nicer she would be willing to help.")
        else:
            sleep(sl)
            print()
            print("The man at the gambling table does indeed know something - so he says at least.")
            print()
            sleep(sl)
            print("He is willing to give you the information if you win a game of galactic poker.")
            print("If you lose, he gets your ship.")
            print()
            sleep(sl)
            print("You see that he hides a blaster in his left hand. It seems you have no choice but to accept the wager.")
            print()
            sleep(sl - 2)
            print("Cards are being dealt and the game starts.")
            sleep(sl + 1)
            print("You are lucky! The gambler stands no chance against your hand.")
            print()
            print("He tells you that Arne, a local Black Market dealer may know something.")
            sleep(1)
            print("Apparently he is a shady guy involved with local smugglers.")
            print()
            sleep(0.5)
            print("If you take a speeder you can be there in 1h.")
            break
            return black_market()
        return 1

def prison_choice():
    sleep(10)
    print("After your clash with the law you find yourself in a jailcell, stripped of most of your equipment.")
    print()
    sleep(1)
    print("What will you do?")
    print()
    print("Option 1: Wait for your space attorney.")
    print()
    print("Option 2: Try to escape the cell.")
    print()
    prompt = "Please type 1 or 2 to a choice: "
    length = 2
    choice = clean_input(prompt, length)
    if choice == 1:
        print()
        print("You wait.")
        sleep(20)
        print()
        print("Hours pass.")
        sleep(20)
        print()        
        print("You slowly realize nobody will be coming.")
        sleep(10)
        print()
        print("Why did you even think that a bounty hunter like you could be saved by an attorney on some far away planet?")
        sleep(5)
        print()
        print()
        print("GAME OVER.")
        return 0
    else:
        print()
        print("You decide to scour the cell and the equipment you still have on you.")
        sleep(sl)
        print()
        print("You remember that you always carry a some explosives in your left shoe. A habit you could not shake since your childhood.")
        sleep(sl)
        print()
        print("You blow a hole in the wall. That was easy!")
        print()
        sleep(sl)
        print("You decide to head to the Black Market before the guards notice. They must be sleeping veeeeeeery tightly you think to yourself.")
        return 1

# def black market function
def black_market(character, karma):
    # implement
    # call side_quest
    # call market_fight_scene
    # How does the bountyhunter know to approach Arne if he was in jail?
    sleep(5)
    print()
    print()
    print("The jam-packed paths through booths full of everything from death sticks to ??? remember you of Mos-Eisley")
    sleep(3)
    print("You start the search for Arne.")
    sleep(3)
    print("It doesn’t take long as he seems to be very known around the place.")
    sleep(5)
    print()
    print("Definitely, he’s one of the more wealthy shop owners in the market.")
    sleep(4)
    pint("He not just has a booth but an entire store filled with Bounty Hunter droids, genosian technic, and basically everything else that’s forbidden in the Republic.")
    sleep(5)
    print()
    print("\x1B[3m" + "Ahhh what are you lookin for? I can get you everything from here ‘til Nal’utta." + "\x1B[0m" + " He says with a wide grin.")
    sleep(5)
    print()
    print("As you explain what you’re looking for, his grin starts to vanish...")
    sleep(3)
    print()
    print("\x1B[3m" + "Look, my man, I’m no lookin for trouble ‘ere, lemme say I could know something, but you look like someone who can solve problems…" + "\x1B[0m")
    sleep(10)
    print("\x1B[3m" + "And as it just so ‘appens, I ‘ave a problem that needs to be solved." + "\x1B[0m")
    sleep(5)
    print("What will you do?")
    print()
    print("Option 1: Help Arne")
    print()
    print("Option 2: Threat him")
    print()
    prompt = "Please type 1 or 2 to a choice: "
    length = 2
    choice = clean_input(prompt, length)
    
    return 1

# def side quest function
def side_quest(character, karma):
    print("This seems like a reasonable deal for you.")
    print()
    sleep(3)
    print("You nod.")
    print()
    sleep(3)
    print("\x1B[3m" + "Okay, a couple of days ago some guys took something from my shop." + "\x1B[0m")
    print()
    sleep(5)
    print("\x1B[3m" + "Shady guys..." + "\x1B[0m")
    print()
    sleep(3)
    print("I want it back.")
    print()
    sleep(4)
    print("He gives you the adress of a nearby warehouse.")
    print()
    sleep(5)
    print("It's a xy")
    print()
    sleep(3)
    print("You get on your way, you better want to do this quick...")
    print()
    sleep(3)
    print("After spying out the warehouse you conclude that you have two options.")
    print()
    sleep(5)
    print("Option 1: There are only two guards are protecting the main entrance and it doesn't seem like there would be many people inside. With some force, you might fight your way through.")
    print()
    print("Option 2: You noticed an unprotected back door with a datapad. With some hacking skills you might make your way through it. ")
    print()
    prompt = "Please type 1 or 2 to a choice: "
    length = 2
    choice = clean_input(prompt, length)

    return 1

def side_quest_force():
    
    return 1
    
def side_quest_hacking():
    print("Deciding that a stealth approach is smarter than risking a fight, you approach the backdoor.")
    print()
    sleep(3)
    print("Hopefully your skills are good enough to crack the code.")
    print()
    sleep(3)
    quick_time_hacking_1()
    print()
    sleep(5)
    quick_time_hacking_2()
    print()
    sleep(5)
    quick_time_hacking_3()
    print()
    sleep(3)
    print("It worked!")
    print()
    sleep(3)
    
    
    return 1

def market_fight_scene(character, karma):
    # implement
    print("You decide it's not worth your time bothering with his problems.")
    print()
    sleep(5)
    print("You threaten Arne to tell you where the Holocron is.")
    print()
    sleep(3)
    print("As you yell at him, more and more shady people start to enter his shop.")
    print()
    print("Noticing this your voice is getting quieter and quieter.")
    print()
    sleep(5)
    print("\x1B[3m" + "How the tables turn" + "\x1B[0m" + " says Arne with an ominous grin.")
    sleep(5)
    print("The people start closing in on you.")
    if character == "Smuggler":
        sleep(3)
        print("You try to reach your Blaster.")
        print()
        sleep(2)
        print("It gets punched out of your hand immediately!")
        print()
        sleep(3)
        print("You're not used to fight with your bare hands.")
        print("The people start hitting you with bats and vibro-axes.")
        sleep(5)
        print("This black market will be your grave.")
        print()
        print()
        sleep(5)
        print("GAME OVER")
        return 0
    
    elif character == "Jedi":
        sleep(3)
        print()
        print("It is enough to pull your lightsaber to scare off the rabble.")
        sleep(5)
        print()
        print("As you turn to Arne again he's shaking out of fear.")
        sleep(3)
        print("\x1B[3m"+ "\"I had no idea you're a Jedi\"" + "\x1B[0m" + "he whispers silently")
        sleep(5)
        print()
        print("\x1B[3m" + "Liiisten....." + "\x1B[0m")
        sleep(5)
        print()
        print("\x1B[3m" + "I had nothing to do with the theft of the Holocron..." + "\x1B[0m")
        sleep(5)
        print("\x1B[3m" + "Look there's a secret base in the SACH53N sector....." + "\x1B[0m")
        sleep(5)
        print("\x1B[3m" + "I heard some rumors about some valuable artifact they got, but I swear that's everything I know..." + "\x1B[0m")
        sleep(3)
        print("\x1B[3m" + "But I have nothing to do with them, so I can't guarantee nothing, but I would look there" + "\x1B[0m")
        print()
        sleep(5)
        print("You decide that he's telling the truth.")
        sleep(5)
        print("You put your lightsaber away.")
        sleep(5)
        print("The SACH53N sector is far out you will need some time to reach it")
        return 1
              
    elif character == "Bounty Hunter":
        sleep(3)
        print()
        print("Although you are outnumbered, these townsfolks are no match for you.")
        sleep(5)
        quick_time_fight_1()
        print()
        sleep(3)
        quick_time_fight_2()
        sleep(3)
        print()
        print("After fighting them, you turn toward Arne.")
        sleep(5)
        print()
        print("As he retreats, he starts hastily talking:")
        print()
        sleep(3)
        print("\x1B[3m" + "Look body, the Holocron ....." + "\x1B[0m")
        sleep(3)
        print("\x1B[3m" + "I was only the middleman, it's no longer here" + "\x1B[0m")
        sleep(3)
        print("\x1B[3m" + "I sold it to some shady guys, weird people who got their base in the SACH53N sector!" + "\x1B[0m")
        sleep(3)
        print("\x1B[3m" + "That's all I know I swear" + "\x1B[0m")
        print()
        sleep(5)
        print("The SACH53N sector you think...")
        print()
        sleep(3)
        print("That's quite far out. You decide to leave immediately for it.")
        print()
        sleep(5)
        print("You leave Arne whimpering in a destroyed booth.")
        return 1
              

def SACH3N_sector(character, karma):
    sleep(5)
    print()
    print("After strolling for hours through the sector you still didn’t find anything…")
    sleep(3)
    print()
    print("As you approach a big canyon, you feel no longer unobserved…")
    sleep(3)
    print()
    print("You hear grunting...")
    sleep(1)
    print()
    print("Something is moving under the sand across the abyss....")
    sleep(2)
    print()
    print("\x1B[3m" + "Trrööööllllllaaaaaaaa" + "\x1B[0m")
    sleep(4)
    print()
    print("A particularly ugly rancor emerges, it seems as if he smelled you…")
    sleep(5)
    print("However, you stay calm.")
    sleep(3)
    print("There is a nearly 10-meter gap between you and the Rancor.")
    sleep(5)
    print()
    print("And every child knows that Rancors aren't the smartest....")
    sleep(5)
    print()
    print("As if he would like to prove it, the ugly Rancor suddenly starts sprinting toward you…")
    sleep(3)
    print("It seems as if he wouldn’t mind the gap.")
    sleep(5)
    print()
    print("While falling into the deep he screams one last time…")
    sleep(7)
    print()
    print("At this moment, you want to turn your view away from him you see something…")
    sleep(3)
    print("It seems as if something is approaching the wrecked Rancor.")
    sleep(5)
    print()
    print("As you look closer, it seems some heavily armed mercenaries inspect the Rancor.")
    sleep(5)
    print()
    print("Seems like you finally found the base!")
    return 1
        
# Credit: Stackoverflow User: AKX & Anthony
def quick_time_fight_1():
    timeout = 3
    t = Timer(timeout, print, ["You were hit!"])
    t.start()
    start_time = time.time()
    prompt = f" Quick dodge the hit, with pressing enter!\n"
    answer = input(prompt)
    t.cancel()
    end_time = time.time()
    reaction_time = end_time - start_time
    if reaction_time > timeout:
         return lost_quick_time()
            
    else:
        print("You dodged the hit!")
        

def quick_time_fight_2():
    timeout = 3
    t = Timer(timeout, print, ["You were hit!"])
    t.start()
    start_time = time.time()
    prompt = f"Now give hime something back! Press enter again!\n"
    answer = input(prompt)
    t.cancel()
    end_time = time.time()
    reaction_time = end_time - start_time
    if reaction_time > timeout:
         return lost_quick_time()
            
    else:
        print("You punched him into his face!")
        
def lost_quick_time():
    print("You were not quick enough...")
    print()
    sleep(3)
    print("You didn't managed it to fight them.")
    print()
    sleep(3)
    print("This Shop will be your grave...")
    print()
    sleep(5)
    print("GAME OVER")
    return 0

def quick_time_hacking_1():
        timeout = 4
        t = Timer(timeout, print, ["The System seems to detect you!"])
        t.start()
        start_time = time.time()
        prompt = f"3 + 5 equals?"
        answer = int(input())
        t.cancel()
        end_time = time.time()
        reaction_time = end_time - start_time
        if answer != 8:
            return hacking_wrong()
            
        elif reaction_time < timeout and answer == 8:
            print("Yes! Now go on!")
        
        elif reaction_time > timeout:
            return hacking_too_long()    

def quick_time_hacking_2():
        timeout = 6
        t = Timer(timeout, print, ["The System seems to detect you!"])
        t.start()
        start_time = time.time()
        prompt = f"9 * 8 equals?"
        answer = int(input())
        t.cancel()
        end_time = time.time()
        reaction_time = end_time - start_time
        if answer != 72:
            return hacking_wrong()
            
        elif reaction_time < timeout and answer == 72:
            print("Yes! Now go on!")
        
        elif reaction_time > timeout:
            return hacking_too_long()
            
def quick_time_hacking_3():
        timeout = 10
        t = Timer(timeout, print, ["The System seems to detect you!"])
        t.start()
        start_time = time.time()
        prompt = f" 2^4 equals?"
        answer = int(input())
        t.cancel()
        end_time = time.time()
        reaction_time = end_time - start_time
        if answer != 16:
            return hacking_wrong()
            
        elif reaction_time < timeout and answer == 16:
            print("You're though!")
        
        elif reaction_time > timeout:
            return hacking_too_long()
        
def hacking_wrong():
    print("Dammit, you got detected!")
    print()
    sleep(2)
    print("You get immeaditley shocked by the datapad!")
    print()
    sleep(3)
    print("It doesn't seem like you will continue your mission...")
    print()
    sleep(5)
    print("GAME OVER")
    return 0
            
def hacking_too_long():
    print("Dammit, you got detected!")
    print()
    sleep(2)
    print("You get immeaditley shocked by the datapad!")
    print()
    sleep(3)
    print("It doesn't seem like you will continue your mission...")
    print()
    sleep(5)
    print("GAME OVER")
    return 0
          

def main():
    karma = 0
    character = choose_character()
    intro_sequence(character)
    karma = bar(character, karma)


main()
